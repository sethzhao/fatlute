var AboutPanel=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createView=function(){var t=(egret.MainContext.instance.stage.stageWidth,egret.MainContext.instance.stage.stageHeight,Utils.createBitmap("about-bg"));this.addChild(t);var e='<e:Group xmlns:e="http://ns.egret.com/eui">\n                <e:Scroller height="1032">\n                    <e:Skin>\n                        <e:VScrollBar id="verticalScrollBar" width="13" height="100%" right="15" autoVisibility = "false">\n                            <e:Skin>\n                                <e:Image id="thumb" width="13" height="767" source="resource/assets/thumb.png" />\n                            </e:Skin>\n                        </e:VScrollBar>\n                    </e:Skin>\n                    <e:Group>\n                        <e:Image width="100%" height="1683" source="resource/assets/about.png" />\n                    </e:Group>\n                </e:Scroller>\n            </e:Group>',i=EXML.parse(e),s=new i;this.addChild(s);var n=new egret.Sprite,a=Utils.createBitmap("back-btn");n.addChild(a),n.x=150,n.y=1060,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.back,this),this.addChild(n);var h=new egret.Sprite,r=Utils.createBitmap("share-btn");h.addChild(r),h.x=395,h.y=1060,h.touchEnabled=!0,h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.share,this),this.addChild(h),this.sharePanel=new SharePanel,this.touchEnabled=!0},s.back=function(){this.close()},s.share=function(){this.addChild(this.sharePanel)},s.close=function(){this.parent.removeChild(this)},e}(egret.Sprite);egret.registerClass(AboutPanel,"AboutPanel");var ApiService=function(){function t(){this.urlloader=new egret.URLLoader,this.urlloader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadError,this)}var e=(__define,t),i=e.prototype;return i.onLoadError=function(t){alert("出现错误，请稍后再试"),egret.MainContext.instance.stage.removeChild(Spinner.instance())},t.instance=function(){return null==this._instance&&(this._instance=new t),this._instance},i.post=function(t,e,i){void 0===e&&(e={}),void 0===i&&(i=null),egret.MainContext.instance.stage.addChild(Spinner.instance());var s=new egret.URLRequest;s.method=egret.URLRequestMethod.POST;var n=[];for(var a in e)n.push(a+"="+e[a]);n.length&&(s.data=new egret.URLVariables(n.join("&"))),s.url=t+"?_r="+Math.random(),this.urlloader.load(s);var h=function(){egret.MainContext.instance.stage.removeChild(Spinner.instance());var t=JSON.parse(this.urlloader.data);i&&i(t),this.urlloader.removeEventListener(egret.Event.COMPLETE,h,this)};this.urlloader.addEventListener(egret.Event.COMPLETE,h,this)},t}();egret.registerClass(ApiService,"ApiService");var Constants=function(){function t(){}var e=(__define,t);e.prototype;return t.SPEED=6,t.STAY=0,t.UP=1,t.RIGHT=2,t.DOWN=3,t.LEFT=4,t.RESTART=0,t.SHARE=1,t}();egret.registerClass(Constants,"Constants");var Controller=function(t){function e(){t.call(this),this.createViews(),this.addGameEventListener(),this.y=883}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createViews=function(){this.upBtn=new egret.Sprite,this.upBtn.addChild(Utils.createBitmap("up")),this.upBtn.x=154;var t=new egret.Shape;t.graphics.beginFill(16711680),t.graphics.drawCircle(this.upBtn.width/2,this.upBtn.height/2,60),t.graphics.endFill(),t.alpha=0,this.upBtn.addChild(t),this.addChild(this.upBtn),this.rightBtn=new egret.Sprite,this.rightBtn.addChild(Utils.createBitmap("right")),this.rightBtn.x=240,this.rightBtn.y=84;var e=new egret.Shape;e.graphics.beginFill(16776960),e.graphics.drawCircle(this.rightBtn.width/2,this.rightBtn.height/2,60),e.graphics.endFill(),e.alpha=0,this.rightBtn.addChild(e),this.addChild(this.rightBtn),this.downBtn=new egret.Sprite,this.downBtn.addChild(Utils.createBitmap("down")),this.downBtn.x=154,this.downBtn.y=169;var i=new egret.Shape;i.graphics.beginFill(16711935),i.graphics.drawCircle(this.downBtn.width/2,this.downBtn.height/2,60),i.graphics.endFill(),i.alpha=0,this.downBtn.addChild(i),this.addChild(this.downBtn),this.leftBtn=new egret.Sprite,this.leftBtn.addChild(Utils.createBitmap("left")),this.leftBtn.x=71,this.leftBtn.y=84;var s=new egret.Shape;s.graphics.beginFill(65535),s.graphics.drawCircle(this.leftBtn.width/2,this.leftBtn.height/2,60),s.graphics.endFill(),s.alpha=0,this.leftBtn.addChild(s),this.addChild(this.leftBtn);var n=Utils.createBitmap("center");n.x=154,n.y=84,this.addChild(n),this.dropBtn=Utils.createBitmap("drop"),this.dropBtn.x=502,this.dropBtn.y=43,this.addChild(this.dropBtn)},s.addGameEventListener=function(){this.upBtn.touchEnabled=!0,this.upBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.upBegin,this),this.upBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.end,this),this.upBtn.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.end,this),this.rightBtn.touchEnabled=!0,this.rightBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.rightBegin,this),this.rightBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.end,this),this.rightBtn.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.end,this),this.downBtn.touchEnabled=!0,this.downBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.downBegin,this),this.downBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.end,this),this.downBtn.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.end,this),this.leftBtn.touchEnabled=!0,this.leftBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.leftBegin,this),this.leftBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.end,this),this.leftBtn.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.end,this),this.dropBtn.touchEnabled=!0,this.dropBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.drop,this)},s.upBegin=function(){this.dispatchEventWith("upBegin")},s.rightBegin=function(){this.dispatchEventWith("rightBegin")},s.downBegin=function(){this.dispatchEventWith("downBegin")},s.leftBegin=function(){this.dispatchEventWith("leftBegin")},s.end=function(){this.dispatchEventWith("end")},s.drop=function(){this.dispatchEventWith("drop")},e}(egret.Sprite);egret.registerClass(Controller,"Controller");var Countdown=function(t){function e(){t.call(this),this.createView(),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addToStage=function(){this.createTimer();var t=RES.getRes("countTime_mp3"),e=t.play(0,1);e.addEventListener(egret.Event.SOUND_COMPLETE,function(){var t=RES.getRes("begin_mp3");t.play(0,1)},this)},s.createView=function(){this.time=new egret.Bitmap,this.time.texture=RES.getRes("countdown3"),this.addChild(this.time);var t=egret.MainContext.instance.stage.stageWidth,e=egret.MainContext.instance.stage.stageHeight;this.x=(t-this.width)/2,this.y=(e-this.height)/2},s.createTimer=function(){this.timer=new egret.Timer(1e3,4),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.timer.start()},s.timerFunc=function(t){var e=t.target.currentCount;4>e&&(this.time.texture=RES.getRes("countdown"+(3-e)))},s.timerComFunc=function(t){this.parent.removeChild(this),this.dispatchEventWith("start")},e}(egret.Sprite);egret.registerClass(Countdown,"Countdown");var FailurePanel=function(t){function e(){t.call(this),this.createView(),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addToStage=function(){this.textField.text="共计消灭"+Score.instance().getVal()+"个油泥"},s.createView=function(){var t=egret.MainContext.instance.stage.stageWidth,e=egret.MainContext.instance.stage.stageHeight;this._panel=new egret.Sprite;var i=Utils.createBitmap("result-panel");this._panel.addChild(i),this._panel.x=69,this._panel.y=188,this.addChild(this._panel);var s=Utils.createBitmap("failure-word");s.x=96,s.y=163,this._panel.addChild(s),this.textField=new egret.TextField,this.textField.bold=!0,this.textField.textColor=16705424,this.textField.size=40,this.textField.x=50,this.textField.y=425,this.textField.width=517,this.textField.textAlign="center",this.textField.fontFamily="'Microsoft YaHei', Arial, sans-serif",this._panel.addChild(this.textField),this.graphics.beginFill(0,.8),this.graphics.drawRect(0,0,t,e),this.graphics.endFill();var n=new egret.Sprite,a=Utils.createBitmap("retry-btn");n.addChild(a),n.x=149,n.y=555,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.retry,this),this._panel.addChild(n);var h=new egret.Sprite,r=Utils.createBitmap("about-btn");h.addChild(r),h.x=149,h.y=653,h.touchEnabled=!0,h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.about,this),this._panel.addChild(h),this.touchEnabled=!0},s.retry=function(){this.close(),this.dispatchEventWith("retry")},s.about=function(){this.dispatchEventWith("about")},s.close=function(){this.parent.removeChild(this)},e}(egret.Sprite);egret.registerClass(FailurePanel,"FailurePanel");var Fatlute=function(t){function e(e,i){t.call(this),this.speed=1e3,this.lastOrientation=0,this.width=this.height=70,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.curPlace=e,this.mapPlaces=i,this.createViews(),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addToStage=function(){this.move()},s.createViews=function(){var t=Utils.createBitmap("fatlute");t.x=(this.width-t.width)/2,t.y=(this.height-t.height)/2+10,this.addChild(t)},s.move=function(){var t=[];this.curPlace.y>0&&!this.mapPlaces[this.curPlace.y-1][this.curPlace.x].isBlock&&t.push(Constants.UP),this.curPlace.x<8&&!this.mapPlaces[this.curPlace.y][this.curPlace.x+1].isBlock&&t.push(Constants.RIGHT),this.curPlace.y<14&&!this.mapPlaces[this.curPlace.y+1][this.curPlace.x].isBlock&&t.push(Constants.DOWN),this.curPlace.x>0&&!this.mapPlaces[this.curPlace.y][this.curPlace.x-1].isBlock&&t.push(Constants.LEFT);var e=-1;if((this.lastOrientation==Constants.RIGHT||this.lastOrientation==Constants.LEFT)&&2==t.length&&t.indexOf(Constants.RIGHT)>-1&&t.indexOf(Constants.LEFT)>-1&&(e=this.lastOrientation),(this.lastOrientation==Constants.UP||this.lastOrientation==Constants.DOWN)&&2==t.length&&t.indexOf(Constants.UP)>-1&&t.indexOf(Constants.DOWN)>-1&&(e=this.lastOrientation),-1==e){var i=Math.floor(Math.random()*t.length);e=t[i]}switch(e){case Constants.UP:this.curPlace=this.mapPlaces[this.curPlace.y-1][this.curPlace.x],this.lastOrientation==Constants.UP||(this.lastOrientation==Constants.RIGHT?this.rotation-=90:this.lastOrientation==Constants.DOWN?this.scaleX=-this.scaleX:this.lastOrientation==Constants.LEFT?this.rotation+=90:this.rotation+=90);break;case Constants.RIGHT:this.curPlace=this.mapPlaces[this.curPlace.y][this.curPlace.x+1],this.lastOrientation==Constants.UP?this.rotation+=90:this.lastOrientation==Constants.RIGHT||(this.lastOrientation==Constants.DOWN?this.rotation-=90:this.lastOrientation==Constants.LEFT?this.scaleX=-this.scaleX:this.scaleX=-this.scaleX);break;case Constants.DOWN:this.curPlace=this.mapPlaces[this.curPlace.y+1][this.curPlace.x],this.lastOrientation==Constants.UP?this.scaleX=-this.scaleX:this.lastOrientation==Constants.RIGHT?this.rotation+=90:this.lastOrientation==Constants.DOWN||(this.lastOrientation==Constants.LEFT?this.rotation-=90:this.rotation-=90);break;case Constants.LEFT:this.curPlace=this.mapPlaces[this.curPlace.y][this.curPlace.x-1],this.lastOrientation==Constants.UP?this.rotation-=90:this.lastOrientation==Constants.RIGHT?this.scaleX=-this.scaleX:this.lastOrientation==Constants.DOWN?this.rotation+=90:this.lastOrientation==Constants.LEFT}this.lastOrientation=e,egret.Tween.get(this).to({x:70*this.curPlace.x+35,y:70*this.curPlace.y+35},this.speed).call(this.move,this)},e}(egret.Sprite);egret.registerClass(Fatlute,"Fatlute");var Game=function(t){function e(){t.call(this),this.droped=!1,this.status=e.STATUS_NORMAL,this._lastTime=egret.getTimer(),this.createViews()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addFrameListen=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this)},s.removeFrameListen=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this)},s.createViews=function(){var t=Utils.createBitmap("bg");this.addChild(t),this.addChild(Time.instance()),Time.instance().addEventListener("timeUp",this.timeUp,this),this.addChild(Score.instance()),this.gameMap=new GameMap(Utils.random(1,3)),this.addChild(this.gameMap),this.hero=new Hero,this.gameMap.addChildInPlaceByYX(this.hero,1,1),this.controller=new Controller,this.addChild(this.controller),this.failurePanel=new FailurePanel,this.failurePanel.addEventListener("retry",this.retry,this),this.failurePanel.addEventListener("about",this.about,this),this.successPanel=new SuccessPanel,this.successPanel.addEventListener("info",this.info,this),this.successPanel.addEventListener("retry",this.retry,this),this.successPanel.addEventListener("about",this.about,this),this.infoPanel=new InfoPanel,this.infoPanel.addEventListener("submitSuccess",this.submitSuccess,this),this.aboutPanel=new AboutPanel,this.submitSuccessPanel=new SubmitSuccessPanel,this.submitSuccessPanel.addEventListener("retry",this.retry,this),this.submitSuccessPanel.addEventListener("about",this.about,this),this.countdown=new Countdown,this.countdown.addEventListener("start",this.start,this),this.addChild(this.countdown)},s.addControllerListener=function(){this.controller.addEventListener("upBegin",this.hero.moveUp,this.hero),this.controller.addEventListener("rightBegin",this.hero.moveRight,this.hero),this.controller.addEventListener("downBegin",this.hero.moveDown,this.hero),this.controller.addEventListener("leftBegin",this.hero.moveLeft,this.hero),this.controller.addEventListener("end",this.hero.stay,this.hero),this.controller.addEventListener("drop",this.drop,this),this.addKeyListener()},s.removeControllerListener=function(){this.controller.removeEventListener("upBegin",this.hero.moveUp,this.hero),this.controller.removeEventListener("rightBegin",this.hero.moveRight,this.hero),this.controller.removeEventListener("downBegin",this.hero.moveDown,this.hero),this.controller.removeEventListener("leftBegin",this.hero.moveLeft,this.hero),this.controller.removeEventListener("end",this.hero.stay,this.hero),this.controller.removeEventListener("drop",this.drop,this)},s.start=function(){var t=RES.getRes("bgm_mp3");t.play(0,-1),this.fatlutes=this.createFatlutes(e.FATLUTE_NUM),this.addControllerListener(),this.addFrameListen(),Time.instance().start()},s.timeUp=function(){Score.instance().getVal()>=e.SUCCESS_SCORE?this.success():this.die()},s.success=function(){this.status==e.STATUS_NORMAL&&(this.status=e.STATUS_SUCCESS,this.removeFrameListen(),this.removeControllerListener(),Time.instance().stop(),this.addChild(this.successPanel))},s.die=function(){this.status==e.STATUS_NORMAL&&(this.status=e.STATUS_DEAD,this.removeFrameListen(),this.removeControllerListener(),Time.instance().stop(),this.addChild(this.failurePanel))},s.retry=function(){this.removeChild(this.gameMap),egret.Tween.removeAllTweens(),this.gameMap=new GameMap(Utils.random(1,3)),this.addChildAt(this.gameMap,this.getChildIndex(this.controller)),this.hero.reset(),this.gameMap.addChildInPlaceByYX(this.hero,1,1),this.fatlutes=this.createFatlutes(e.FATLUTE_NUM),this.addControllerListener(),this.addFrameListen(),Score.instance().reset(),Time.instance().restart(),this.status=e.STATUS_NORMAL},s.submitSuccess=function(){this.addChild(this.submitSuccessPanel)},s.info=function(){this.addChild(this.infoPanel)},s.about=function(){this.addChild(this.aboutPanel)},s.createFatlutes=function(t){for(var e=[],i=0;t>i;i++){var s=this.gameMap.findPlaceByPx(this.hero.y,this.hero.x),n=this.gameMap.randomSafePlace(s),a=new Fatlute(n,this.gameMap.places);e.push(a),this.gameMap.addChildInPlace(a,n)}return e},s.drop=function(){if(!this.droped){this.droped=!0;var t=this.gameMap.findPlaceByPx(this.hero.y,this.hero.x),e=new Oil;this.gameMap.addChildInPlace(e,t);var i=RES.getRes("drop_mp3");i.play(0,1),egret.setTimeout(function(){var i=this.gameMap.findRoads(t.y,t.x,"up"),s=this.gameMap.findRoads(t.y,t.x,"right"),n=this.gameMap.findRoads(t.y,t.x,"down"),a=this.gameMap.findRoads(t.y,t.x,"left");e.explode(i.length,s.length,n.length,a.length);var h=i.concat(s).concat(n).concat(a).concat(t);this.hitFatlute(h),this.droped=!1},this,1e3)}},s.hitFatlute=function(t){for(var i=0;i<this.fatlutes.length;i++){var s=this.fatlutes[i],n=this.gameMap.findPlaceByPx(s.y,s.x);if(-1!=t.indexOf(n)){egret.Tween.removeTweens(s),s.parent.removeChild(s),this.fatlutes.splice(this.fatlutes.indexOf(s),1),this.fatlutes=this.fatlutes.concat(this.createFatlutes(1)),i--;var a=RES.getRes("hit_mp3");a.play(0,1),this.status==e.STATUS_NORMAL&&Score.instance().add()}}},s.touchFatlute=function(){for(var t=0;t<this.fatlutes.length;t++){var e=this.fatlutes[t],i=e.localToGlobal(35,35);if(this.hero.hitTestPoint(i.x,i.y,!1)){var s=RES.getRes("die_mp3");s.play(0,1),this.die();break}}},s.addKeyListener=function(){var t=this;document.addEventListener("keydown",function(e){switch(e.keyCode){case 87:t.hero.status=Constants.UP;break;case 68:t.hero.status=Constants.RIGHT;break;case 83:t.hero.status=Constants.DOWN;break;case 65:t.hero.status=Constants.LEFT;break;case 73:t.drop()}}),document.addEventListener("keyup",function(e){t.hero.status=Constants.STAY})},s.speedOffset=function(){var t=egret.getTimer(),e=1e3/(t-this._lastTime);return this._lastTime=t,30/e},s.gameViewUpdate=function(){this.updateHero(Math.floor(Constants.SPEED*this.speedOffset())),this.touchFatlute()},s.updateHero=function(t){switch(this.hero.status){case Constants.UP:var e=this.gameMap.findPlaceByPx(this.hero.y-35-t,this.hero.x-35),i=this.gameMap.findPlaceByPx(this.hero.y-35-t,this.hero.x+34);if(!e&&!i)break;if(e.isBlock&&i.isBlock)break;if(e&&e.isBlock){if(this.hero.x>e.getPxPoint().x+69){var s=this.hero.x-(e.getPxPoint().x+69);this.hero.x+=35-s>t?t:1}break}if(i&&i.isBlock){if(this.hero.x<i.getPxPoint().x){var s=i.getPxPoint().x-this.hero.x;this.hero.x-=35-s>t?t:1}break}this.hero.y-=t;break;case Constants.RIGHT:var n=this.gameMap.findPlaceByPx(this.hero.y-35,this.hero.x+34+t),a=this.gameMap.findPlaceByPx(this.hero.y+34,this.hero.x+34+t);if(!n&&!a)break;if(n.isBlock&&a.isBlock)break;if(n&&n.isBlock){if(this.hero.y>n.getPxPoint().y+69){var s=this.hero.y-(n.getPxPoint().y+69);this.hero.y+=35-s>t?t:1}break}if(a&&a.isBlock){if(this.hero.y<a.getPxPoint().y){var s=a.getPxPoint().y-this.hero.y;this.hero.y-=35-s>t?t:1}break}this.hero.x+=t;break;case Constants.DOWN:var e=this.gameMap.findPlaceByPx(this.hero.y+34+t,this.hero.x-35),i=this.gameMap.findPlaceByPx(this.hero.y+34+t,this.hero.x+34);if(!e&&!i)break;if(e.isBlock&&i.isBlock)break;if(e&&e.isBlock){if(this.hero.x>e.getPxPoint().x+69){var s=this.hero.x-(e.getPxPoint().x+69);this.hero.x+=35-s>t?t:1}break}if(i&&i.isBlock){if(this.hero.x<i.getPxPoint().x){var s=i.getPxPoint().x-this.hero.x;this.hero.x-=35-s>t?t:1}break}this.hero.y+=t;break;case Constants.LEFT:var n=this.gameMap.findPlaceByPx(this.hero.y-35,this.hero.x-35-t),a=this.gameMap.findPlaceByPx(this.hero.y+34,this.hero.x-35-t);if(!n&&!a)break;if(n.isBlock&&a.isBlock)break;if(n&&n.isBlock){if(this.hero.y>n.getPxPoint().y+69){var s=this.hero.y-(n.getPxPoint().y+69);this.hero.y+=35-s>t?t:1}break}if(a&&a.isBlock){if(this.hero.y<a.getPxPoint().y){var s=a.getPxPoint().y-this.hero.y;this.hero.y-=35-s>t?t:1}break}this.hero.x-=t}},e.GAME_TIME=60,e.SUCCESS_SCORE=10,e.FATLUTE_NUM=8,e.STATUS_NORMAL=0,e.STATUS_DEAD=1,e.STATUS_SUCCESS=2,e}(egret.DisplayObjectContainer);egret.registerClass(Game,"Game");var GameMap=function(t){function e(e){t.call(this),this.createViews(e),this.parsePlaces(e),this.placeLayer=new egret.DisplayObjectContainer,this.placeLayer.x=60,this.placeLayer.y=118,this.addChild(this.placeLayer),this.heroLayer=new egret.DisplayObjectContainer,this.oilLayer=new egret.DisplayObjectContainer,this.fatluteLayer=new egret.DisplayObjectContainer,this.placeLayer.addChild(this.fatluteLayer),this.placeLayer.addChild(this.oilLayer),this.placeLayer.addChild(this.heroLayer)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createViews=function(t){var e=Utils.createBitmap("map"+t);this.addChild(e)},s.parsePlaces=function(t){var e=RES.getRes("maps"),i=e["map"+t];this.places=[],this.roadPlaces=[];for(var s=0;s<i.length;s++){var n=[];this.places.push(n);for(var a=0;a<i[s].length;a++){var h=new Place(s,a);0!=i[s][a]?h.isBlock=!0:(h.isBlock=!1,this.roadPlaces.push(h)),n.push(h)}}},s.addChildInPlace=function(t,e){var i=e.getPxPoint();t.x=i.x+35,t.y=i.y+35,egret.is(t,"Hero")?this.heroLayer.addChild(t):egret.is(t,"Oil")?this.oilLayer.addChild(t):egret.is(t,"Fatlute")?this.fatluteLayer.addChild(t):this.placeLayer.addChild(t)},s.addChildInPlaceByYX=function(t,e,i){var s=this.places[e][i];this.addChildInPlace(t,s)},s.findPlace=function(t,e){return 0>t||t>14||0>e||e>9?null:this.places[t][e]},s.findPlaceByPx=function(t,e){var i=Math.floor(t/70),s=Math.floor(e/70);return 0>i||i>14||0>s||s>9?null:this.places[i][s]},s.findBlock=function(t,e){var i=this.findPlaceByPx(t,e);return i&&i.isBlock?i:null},s.findRoads=function(t,e,i){for(var s=[];;){var n=null;if("up"==i&&(n=this.findPlace(t-1-s.length,e)),"right"==i&&(n=this.findPlace(t,e+1+s.length)),"down"==i&&(n=this.findPlace(t+1+s.length,e)),"left"==i&&(n=this.findPlace(t,e-1-s.length)),!n||n.isBlock)break;s.push(n)}return s},s.randomSafePlace=function(t){for(var e=[],i=0;i<this.roadPlaces.length;i++){var s=this.roadPlaces[i];(Math.abs(s.x-t.x)>5||Math.abs(s.y-t.y)>5)&&e.push(this.roadPlaces[i])}var n=Math.floor(Math.random()*e.length);return e[n]},e}(egret.DisplayObjectContainer);egret.registerClass(GameMap,"GameMap");var Hero=function(t){function e(){t.call(this),this.createViews(),this.width=63,this.height=139,this.anchorOffsetX=33,this.anchorOffsetY=80}__extends(e,t);var i=__define,s=e,n=s.prototype;return n.createViews=function(){this.stayBitmap=Utils.createBitmap("hero"),this.stayBitmap.x=8,this.stayBitmap.y=-10,this.addChild(this.stayBitmap);var t=RES.getRes("walk_data"),e=RES.getRes("walk_textrue"),i=new egret.MovieClipDataFactory(t,e);this.mc=new egret.MovieClip(i.generateMovieClipData("walk")),this.mc.x=-42,this.mc.y=-25},n.reset=function(){this._beforeStatus=null,this.status=Constants.STAY},i(n,"status",function(){return this._status},function(t){this._beforeStatus=this._status,this._status=t,this._status!=Constants.STAY?(this.contains(this.stayBitmap)&&this.removeChild(this.stayBitmap),this.contains(this.mc)||(this.addChild(this.mc),this.mc.play(-1)),this._status==Constants.RIGHT&&(this.mc.scaleX=-1,this.mc.x=106),this._status==Constants.LEFT&&(this.mc.scaleX=1,this.mc.x=-42)):(this.contains(this.mc)&&(this.mc.stop(),this.removeChild(this.mc)),this.contains(this.stayBitmap)||this.addChild(this.stayBitmap),this._beforeStatus==Constants.RIGHT&&(this.stayBitmap.scaleX=-1,this.stayBitmap.x=56),this._beforeStatus==Constants.LEFT&&(this.stayBitmap.scaleX=1,this.stayBitmap.x=8))}),n.moveUp=function(){this.status=Constants.UP},n.moveRight=function(){this.status=Constants.RIGHT},n.moveDown=function(){this.status=Constants.DOWN},n.moveLeft=function(){this.status=Constants.LEFT},n.stay=function(){this.status=Constants.STAY},e}(egret.Sprite);egret.registerClass(Hero,"Hero");var InfoPanel=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createView=function(){var t=egret.MainContext.instance.stage.stageWidth,e=egret.MainContext.instance.stage.stageHeight;this._panel=new egret.Sprite;var i=Utils.createBitmap("info-panel");this._panel.addChild(i),this._panel.x=68,this._panel.y=178,this.addChild(this._panel);var s=Utils.createBitmap("info-oil");s.x=272,s.y=752,this.addChild(s),this.graphics.beginFill(0,.8),this.graphics.drawRect(0,0,t,e),this.graphics.endFill(),this.nameField=new egret.TextField,this.nameField.bold=!0,this.nameField.textColor=2236962,this.nameField.size=34,this.nameField.type=egret.TextFieldType.INPUT,this.nameField.x=190,this.nameField.y=172,this.nameField.width=319,this.nameField.height=63,this.nameField.verticalAlign="middle",this._panel.addChild(this.nameField),this.phoneField=new egret.TextField,this.phoneField.bold=!0,this.phoneField.textColor=2236962,this.phoneField.size=34,this.phoneField.type=egret.TextFieldType.INPUT,this.phoneField.x=190,this.phoneField.y=275,this.phoneField.width=319,this.phoneField.height=63,this.phoneField.verticalAlign="middle",this._panel.addChild(this.phoneField);var n=new egret.Sprite,a=Utils.createBitmap("submit-btn");n.addChild(a),n.x=156,n.y=373,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.submit,this),this._panel.addChild(n),this.touchEnabled=!0},s.submit=function(){var t=this.nameField.text.trim(),e=this.phoneField.text.trim();if(!t)return void alert("请输入姓名");if(!e)return void alert("请输入电话");if(!/^\d{11}$/.test(e))return void alert("请输入正确的电话");var i=this;ApiService.instance().post("/core/api.php",{name:t,phone:e,time:Score.instance().getVal()},function(t){0!=t.error?alert(t.message):i.success()})},s.success=function(){this.close(),this.dispatchEventWith("submitSuccess")},s.close=function(){this.parent.removeChild(this)},e}(egret.Sprite);egret.registerClass(InfoPanel,"InfoPanel");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createView=function(){var t=Utils.createBitmap("bg");this.addChild(t),this.fatlute=Utils.createBitmap("fatlute"),this.fatlute.x=225,this.fatlute.y=473,this.fatlute.scaleX=-1,this.addChild(this.fatlute),this.textField=new egret.TextField,this.textField.x=225,this.textField.y=600,this.textField.width=300,this.textField.textAlign="center",this.textField.text="0%",this.textField.bold=!0,this.textField.italic=!0,this.textField.textColor=16763432,this.textField.size=40,this.addChild(this.textField)},s.setProgress=function(t,e){var i=423,s=225;this.fatlute.x=s+i*(t/e),this.textField.text=Math.floor(t/e*100)+"%"},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("loading"),RES.loadGroup("preload")},s.onResourceLoadComplete=function(t){"loading"==t.groupName&&(this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView)),"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},s.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},s.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},s.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},s.createGameScene=function(){this.game=new Game,this.addChild(this.game)},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var Oil=function(t){function e(){t.call(this),this.isBodyFadeOut=!1,this.width=this.height=70,this.createViews(),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.oilBodyLayer=new egret.Sprite,this.addChild(this.oilBodyLayer)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.explode=function(t,e,i,s){this.removeChild(this.oilBitmap);var n=null;t>0&&e>0&&i>0&&s>0?n=Utils.createBitmap("oil5"):t>0&&e>0&&i>0?(n=Utils.createBitmap("oil4"),n.rotation=-90):e>0&&i>0&&s>0?n=Utils.createBitmap("oil4"):i>0&&s>0&&t>0?(n=Utils.createBitmap("oil4"),n.rotation=90):s>0&&t>0&&e>0?(n=Utils.createBitmap("oil4"),n.rotation=180):t>0&&e>0?(n=Utils.createBitmap("oil3"),n.rotation=-90):e>0&&i>0?n=Utils.createBitmap("oil3"):i>0&&s>0?(n=Utils.createBitmap("oil3"),n.rotation=90):s>0&&t>0?(n=Utils.createBitmap("oil3"),n.rotation=180):t>0&&i>0?n=Utils.createBitmap("oil2"):e>0&&s>0?n=Utils.createBitmap("oil1"):e>0||s>0?n=Utils.createBitmap("oil1"):(t>0||i>0)&&(n=Utils.createBitmap("oil2")),n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.x=35,n.y=35,this.oilBodyLayer.addChild(n);for(var a=1;t>=a;a++)if(a==t){var h=this.makeEnd("up");h.y-=70*a,this.addChild(h),h.play()}else{var r=Utils.createBitmap("oil2");r.y=-(70*a),this.oilBodyLayer.addChild(r)}for(var a=1;e>=a;a++)if(a==e){var h=this.makeEnd("right");h.x+=70*a,this.addChild(h),h.play()}else{var o=Utils.createBitmap("oil1");o.x=70*a,this.oilBodyLayer.addChild(o)}for(var a=1;i>=a;a++)if(a==i){var h=this.makeEnd("down");h.y+=70*a,this.addChild(h),h.play()}else{var l=Utils.createBitmap("oil2");l.y=70*a,this.oilBodyLayer.addChild(l)}for(var a=1;s>=a;a++)if(a==s){var h=this.makeEnd("left");h.x-=70*a,this.addChild(h),h.play()}else{var d=Utils.createBitmap("oil1");d.x=-(70*a),this.oilBodyLayer.addChild(d)}var c=RES.getRes("explode_mp3");c.play(0,1)},s.createViews=function(){this.oilBitmap=Utils.createBitmap("oil"),this.oilBitmap.x=-17,this.oilBitmap.y=-17,this.addChild(this.oilBitmap)},s.bodyFadeOut=function(){this.removeChild(this.oilBodyLayer)},s.makeEnd=function(t){var e=this,i=RES.getRes("oilEnd_data"),s=RES.getRes("oilEnd_textrue"),n=new egret.MovieClipDataFactory(i,s),a=new egret.MovieClip(n.generateMovieClipData("oilEnd"));return a.addEventListener(egret.MovieClipEvent.FRAME_LABEL,function(t){e.isBodyFadeOut||(e.isBodyFadeOut=!0,e.bodyFadeOut())},this),a.addEventListener(egret.Event.COMPLETE,function(t){e.removeChild(a),!e.numChildren&&e.parent&&e.parent.removeChild(e)},this),a.frameRate=15,a.anchorOffsetX=48,a.anchorOffsetY=35,a.x=35,a.y=35,"up"==t?a.rotation=180:"right"==t?a.rotation=-90:"left"==t&&(a.rotation=90),a},e}(egret.Sprite);egret.registerClass(Oil,"Oil");var Place=function(){function t(t,e){this.size=70,this.x=e,this.y=t}var e=(__define,t),i=e.prototype;return i.getPxPoint=function(){return new egret.Point(this.x*this.size,this.y*this.size)},t}();egret.registerClass(Place,"Place");var Score=function(t){function e(){t.call(this),this.score=0,this.createViews(),this.x=382,this.y=43}__extends(e,t);var i=(__define,e),s=i.prototype;return e.instance=function(){return null==this._instance&&(this._instance=new e),this._instance},s.createViews=function(){var t=Utils.createBitmap("score");this.addChild(t),this.textField=new egret.TextField,this.textField.text=""+(this.score>9?this.score:"0"+this.score),this.textField.bold=!0,this.textField.textColor=2359261,this.textField.size=34,this.textField.x=165,this.textField.y=19,this.addChild(this.textField)},s.update=function(){this.textField.text=""+(this.score>9?this.score:"0"+this.score)},s.add=function(){this.score++,this.update()},s.reset=function(){this.score=0,this.update()},s.getVal=function(){return this.score},e}(egret.Sprite);egret.registerClass(Score,"Score");var SharePanel=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createView=function(){var t=egret.MainContext.instance.stage.stageWidth,e=egret.MainContext.instance.stage.stageHeight;
this._panel=new egret.Sprite;var i=Utils.createBitmap("share");this._panel.addChild(i),this._panel.x=392,this._panel.y=35,this.addChild(this._panel),this.graphics.beginFill(0,.8),this.graphics.drawRect(0,0,t,e),this.graphics.endFill(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.close,this)},s.close=function(){this.parent.removeChild(this)},e}(egret.Sprite);egret.registerClass(SharePanel,"SharePanel");var Spinner=function(t){function e(){t.call(this),this.create(),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.show,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return e.instance=function(){return null==this._instance&&(this._instance=new e),this._instance},s.create=function(){var t=egret.MainContext.instance.stage.stageWidth,e=egret.MainContext.instance.stage.stageHeight,i=RES.getRes("spinner_data"),s=RES.getRes("spinner_texture"),n=new egret.MovieClipDataFactory(i,s);this._mc=new egret.MovieClip(n.generateMovieClipData("spinner")),this._mc.x=(t-this._mc.width)/2,this._mc.y=(e-this._mc.height)/2,this.addChild(this._mc),this.graphics.beginFill(0,.8),this.graphics.drawRect(0,0,t,e),this.graphics.endFill(),this.touchEnabled=!0},s.show=function(){this._mc.play(-1)},e}(egret.Sprite);egret.registerClass(Spinner,"Spinner");var SubmitSuccessPanel=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createView=function(){var t=egret.MainContext.instance.stage.stageWidth,e=egret.MainContext.instance.stage.stageHeight;this._panel=new egret.Sprite;var i=Utils.createBitmap("submit-success-panel");this._panel.addChild(i),this._panel.x=69,this._panel.y=195,this.addChild(this._panel),this.graphics.beginFill(0,.8),this.graphics.drawRect(0,0,t,e),this.graphics.endFill();var s=new egret.Sprite,n=Utils.createBitmap("retry-btn");s.addChild(n),s.x=149,s.y=322,s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.retry,this),this._panel.addChild(s);var a=new egret.Sprite,h=Utils.createBitmap("about-btn");a.addChild(h),a.x=149,a.y=421,a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.about,this),this._panel.addChild(a),this.touchEnabled=!0},s.retry=function(){this.close(),this.dispatchEventWith("retry")},s.about=function(){this.dispatchEventWith("about")},s.close=function(){this.parent.removeChild(this)},e}(egret.Sprite);egret.registerClass(SubmitSuccessPanel,"SubmitSuccessPanel");var SuccessPanel=function(t){function e(){t.call(this),this.createView(),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.addToStage=function(){this.textField.text="共计消灭"+Score.instance().getVal()+"个油泥"},s.createView=function(){var t=egret.MainContext.instance.stage.stageWidth,e=egret.MainContext.instance.stage.stageHeight;this._panel=new egret.Sprite;var i=Utils.createBitmap("result-panel");this._panel.addChild(i),this._panel.x=69,this._panel.y=188,this.addChild(this._panel);var s=Utils.createBitmap("success-word");s.x=141,s.y=123,this._panel.addChild(s),this.textField=new egret.TextField,this.textField.bold=!0,this.textField.textColor=16705424,this.textField.size=40,this.textField.x=50,this.textField.y=375,this.textField.width=517,this.textField.textAlign="center",this.textField.fontFamily="'Microsoft YaHei', Arial, sans-serif",this._panel.addChild(this.textField),this.graphics.beginFill(0,.8),this.graphics.drawRect(0,0,t,e),this.graphics.endFill();var n=new egret.Sprite,a=Utils.createBitmap("info-btn");n.addChild(a),n.x=149,n.y=479,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.info,this),this._panel.addChild(n);var h=new egret.Sprite,r=Utils.createBitmap("retry-btn");h.addChild(r),h.x=149,h.y=579,h.touchEnabled=!0,h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.retry,this),this._panel.addChild(h);var o=new egret.Sprite,l=Utils.createBitmap("about-btn");o.addChild(l),o.x=149,o.y=678,o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.about,this),this._panel.addChild(o),this.touchEnabled=!0},s.info=function(){this.close(),this.dispatchEventWith("info")},s.retry=function(){this.close(),this.dispatchEventWith("retry")},s.about=function(){this.dispatchEventWith("about")},s.close=function(){this.parent.removeChild(this)},e}(egret.Sprite);egret.registerClass(SuccessPanel,"SuccessPanel");var Time=function(t){function e(e){t.call(this),this.time=e,this.createViews(),this.x=78,this.y=43}__extends(e,t);var i=(__define,e),s=i.prototype;return e.instance=function(){return null==this._instance&&(this._instance=new e(Game.GAME_TIME)),this._instance},s.createViews=function(){var t=Utils.createBitmap("score");this.addChild(t),this.textField=new egret.TextField,this.textField.bold=!0,this.textField.textColor=16763432,this.textField.size=34,this.textField.text="00:"+(this.time>9?this.time:"0"+this.time),this.textField.x=140,this.textField.y=19,this.addChild(this.textField)},s.start=function(){this.useTime=0,this.timer=new egret.Timer(1e3,this.time),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.timer.start()},s.restart=function(){this.textField.text="00:"+(this.time>9?this.time:"0"+this.time),this.start()},s.stop=function(){this.timer.stop()},s.timerFunc=function(t){var e=t.target.currentCount;this.useTime=e;var i=this.time-this.useTime;this.textField.text="00:"+(i>9?i:"0"+i)},s.timerComFunc=function(t){this.dispatchEventWith("timeUp")},s.getUseTime=function(){return this.useTime},e}(egret.Sprite);egret.registerClass(Time,"Time");var Utils=function(){function t(){}var e=(__define,t);e.prototype;return t.createBitmap=function(t){var e=new egret.Bitmap;return e.texture=RES.getRes(t),e},t.random=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},t.hitTest=function(t,e){var i=t.getBounds(),s=e.getBounds(),n=t.localToGlobal(0,0);i.x=n.x,i.y=n.y;var a=e.localToGlobal(0,0);return s.x=a.x,s.y=a.y,i.intersects(s)},t}();egret.registerClass(Utils,"Utils");